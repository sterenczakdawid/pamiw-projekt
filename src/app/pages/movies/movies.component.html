<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

@if(movies$ | async; as movies) {
<h1 class="title" *transloco="let t; read: 'movies'">{{t('page_title')}}</h1>
<div class="header d-flex justify-content-between align-items-center">
  <a class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#addMovieModal"
    (click)="onOpenModal(null!, 'add')">Add new movie</a>
  <form #searchForm="ngForm" (ngSubmit)="goToPage(searchForm.value.title)" class="d-flex" role="search">
    <input type="text" name="title" ngModel class="form-control me-2" type="search" placeholder="Search"
      aria-label="Search">
    <button mat-stroked-button color="primary" type="submit">Search</button>
  </form>
</div>

<div class="movies__wrapper">
  @for(movie of movies.content; track $index) {
  <div class="card movies__card">
    <img src="{{movie.posterUrl}}" class="card-img-top movies__card__img" alt="movie poster">
    <div class="card-body">
      <h5 class="card-title font-weight-bold">{{movie.title}}</h5>
      <p class="card-text">
        Director: {{movie.director.name}} {{movie.director.surname}}
      </p>
      <p>Released: {{movie.yearOfRelease}}</p>
      <button mat-raised-button color="primary" (click)="onOpenModal(movie, 'edit')">Edit</button>
      <button mat-raised-button color="warn" data-bs-toggle="modal" data-bs-target="#exampleModal"
        (click)="onOpenModal(movie, 'delete')">Delete</button>
    </div>
  </div>
  }
</div>
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li *ngFor="let pageNumber of [].constructor(movies.totalPages); let i = index;" class="page-item pointer">
      <a (click)="goToPage((searchForm.value.title), i)" class="page-link">
        {{ i + 1 }}
      </a>
    </li>
  </ul>
</nav>
}

<!-- Delete modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete movie</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete movie <span class="fw-bold">{{deleteMovie?.title}}</span>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" mat-raised-button color="warn" data-bs-dismiss="modal"
          (click)="onDeleteMovie(deleteMovie)">Yes</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Movie Modal -->
<div class="modal fade" id="addMovieModal" tabindex="-1" role="dialog" aria-labelledby="addMovieModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addMovieModalLabel">Add Movie</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <!-- ten header jest git, to body ewentualnie do zmiany -->
      <div class="modal-body">
        <form #addForm="ngForm" (ngSubmit)="onAddMovie(addForm)">
          <div class="form-group">
            <label for="title">Title</label>
            <input type="text" ngModel name="title" class="form-control" id="title" placeholder="Title" required>
          </div>
          <div class="form-group" *ngIf="directors$ | async as directors">
            <label for="director">Director</label>
            <select ngModel name="director" class="form-control" id="director" placeholder="Director" required>
              <option *ngFor="let director of directors" [ngValue]="director">
                {{ director.name }} {{ director.surname }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="yearOfRelease">Released</label>
            <input type="number" ngModel name="yearOfRelease" class="form-control" id="yearOfRelease" placeholder="2023"
              required>
          </div>
          <div class="form-group">
            <label for="posterUrl">Poster URL</label>
            <input type="text" ngModel name="posterUrl" class="form-control" id="posterUrl" placeholder="Poster URL"
              required>
          </div>
          <div class="modal-footer">
            <button type="button" id="add-movie-form" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button [disabled]="addForm.invalid" type="submit" class="btn btn-primary">Save changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<!-- <div class="modal fade" id="updateMovieModal" tabindex="-1" role="dialog" aria-labelledby="movieEditModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateMovieModalLabel">Edit Movie {{editMovie?.title}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #editForm="ngForm">
          <div class="form-group">
            <label for="title">Title</label>
            <input type="text" ngModel="{{editMovie?.title}}" name="title" class="form-control" id="title"
              aria-describedby="emailHelp" placeholder="Title">
          </div>
          <input type="hidden" ngModel="{{editMovie?.id}}" name="id" class="form-control" id="id" placeholder="">
          <div class="form-group" *ngIf="directors$ | async as directors">
            <label for="director">Director</label>
            <select ngModel name="director" class="form-control" id="director" placeholder="Director" required>
              <option *ngFor="let director of directors" [ngValue]="director">
                {{ director.name }} {{ director.surname }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="yearOfRelease">yearOfRelease</label>
            <input type="number" ngModel="{{editMovie?.yearOfRelease}}" name="yearOfRelease" class="form-control"
              id="yearOfRelease" placeholder="2023">
          </div>
          <div class="form-group">
            <label for="posterUrl">Image URL</label>
            <input type="text" ngModel="{{editMovie?.posterUrl}}" name="posterUrl" class="form-control" id="posterUrl"
              placeholder="Movie URL">
          </div>
          <div class="modal-footer">
            <button type="button" id="" data-dismiss="modal" class="btn btn-secondary">Close</button>
            <button (click)="onUpdateMovie(editForm.value)" data-dismiss="modal" class="btn btn-primary">Save
              changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div> -->